<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="bookList">
	
	<!-- ISBN으로 SELECT -->
	<select id = "isbn" parameterType="String" resultType="bookList.dto.BookListDTO">
		SELECT * FROM BOOKLIST
		WHERE ISBN = #{ISBN}
	</select>

	<!-- 총 후기 수 -->
	<select id = "count" resultType="int">
		SELECT count(*) FROM BOOK_REVIEW
	</select>
	
	<!-- 출력할 review list SELECT -->
	<select id = "reviewList" parameterType="bookList.dto.PageDTO" resultType="bookList.dto.BookReviewDTO">
		<![CDATA[ 
		SELECT y.*
		FROM(SELECT rownum as rm, x.*
		FROM (SELECT *
		FROM BOOK_REVIEW)x)y
		WHERE y.rm>=#{startRow} AND y.rm<=#{endRow}
		]]>
	</select>
	
	<!-- 후기 삽입 -->
	<insert id = "addReview">
		INSERT INTO BOOK_REVIEW (REVIEW_KEYNUM, ISBN, USER_ID, STAR_NUM, REVIEW_CONTENTS, REVIEW_DATE)
		VALUES (key_num_seq.NEXTVAL,#{isbn, jdbcType=VARCHAR}, #{user_id, jdbcType=VARCHAR}, #{star_num}, #{review_contents, jdbcType=VARCHAR}, SYSDATE)
	</insert>
	
	<!-- 후기 수정 -->
	<update id ="updateReview" parameterType="bookList.dto.BookReviewDTO">
		UPDATE BOOK_REVIEW
		SET review_Contents = #{review_Contents}, star_Num = #{star_Num}
		WHERE reviewKeynum = #{review_Keynum}
	</update>
	
	<!-- 후기 삭제 -->
	<delete id = "deleteReview" parameterType="int">
		DELETE FROM BOOK_REVIEW
		WHERE review_Keynum = #{review_Keynum}
	</delete>
</mapper>